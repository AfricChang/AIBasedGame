# 打飞机游戏 - 开发文档

## 游戏概述

这是一个基于HTML5 Canvas的2D射击游戏，玩家控制飞机击败敌机并收集道具来提升能力。

## 核心数值配置

### 玩家属性
- **初始血量**: 100
- **最大血量**: 100
- **初始子弹数**: 1
- **最大子弹数**: 3
- **初始弹道速度倍数**: 1.0
- **最大弹道速度倍数**: 2.5

### 僚机系统
- **最大僚机数量**: 2个（左右各一个）
- **僚机解锁条件**: 连续获得3个弹道道具
- **僚机位置偏移**: 左右各50像素

### 导弹系统
- **最大导弹数量**: 2个
- **第一个导弹解锁**: 收集12个弹道道具
- **第二个导弹解锁**: 收集24个弹道道具
- **导弹发射间隔**: 
  - 单导弹: 3000ms (3秒)
  - 双导弹: 1000ms (1秒)

### 血量包系统
- **血量包恢复量**: 30点
- **自动恢复解锁条件**: 收集10个血量包
- **自动恢复间隔**: 5000ms (5秒)
- **自动恢复量**: 最大血量的10% (10点)
- **保护罩触发**: 满血状态下收集血量包
- **保护罩持续时间**: 5000ms (5秒)

## 敌机类型与属性

### 侦察机 (Scout)
- **尺寸**: 25x25
- **血量**: 1
- **速度倍数**: 1.5倍
- **击杀分数**: 10分
- **碰撞伤害**: 15点
- **出现概率**: 40% (默认)
- **颜色**: 绿色渐变

### 战斗机 (Fighter)
- **尺寸**: 30x30
- **血量**: 2
- **速度倍数**: 1.0倍
- **击杀分数**: 20分
- **碰撞伤害**: 20点
- **出现概率**: 25% (分数≥500时)
- **颜色**: 红色

### 轰炸机 (Bomber)
- **尺寸**: 40x35
- **血量**: 3
- **速度倍数**: 0.7倍
- **击杀分数**: 30分
- **碰撞伤害**: 30点
- **出现概率**: 20% (分数≥1000时)
- **颜色**: 深灰色

### 炮艇 (Gunship)
- **尺寸**: 35x32
- **血量**: 4
- **速度倍数**: 0.8倍
- **击杀分数**: 40分
- **碰撞伤害**: 25点
- **出现概率**: 10% (分数≥1500时)
- **特殊能力**: 可以射击
- **颜色**: 橙色

### Boss机 (Boss)
- **尺寸**: 50x45
- **血量**: 8
- **速度倍数**: 0.5倍
- **击杀分数**: 100分
- **碰撞伤害**: 50点
- **出现概率**: 5% (分数≥2000时)
- **颜色**: 紫色渐变

## 生成机制

### 敌机生成
- **基础间隔**: 1000ms
- **动态调整**: 间隔 = 1000 - (分数 / 10)ms
- **最小间隔**: 理论上可以无限缩短
- **基础速度**: 2-5 + (分数/1000)

### 道具生成
- **生成间隔**: 8000-13000ms (随机)
- **道具类型概率**:
  - 弹道道具: 70%
  - 血量包: 30%

### 障碍物生成
- **生成间隔**: 6000-10000ms (随机)
- **基础速度**: 1-3 + (分数/2000)
- **碰撞伤害**: 25点
- **作用**: 防止挂机，增加游戏难度

## 伤害系统

### 敌机子弹伤害
- **对玩家**: 15点血量 或 减少1个子弹数
- **优先扣除子弹数**: 子弹数>1时优先扣子弹

### 玩家子弹伤害
- **对所有敌机**: 1点伤害

### 碰撞伤害 (详见敌机类型)
- **保护罩**: 完全免疫所有伤害

## 分数系统

### 击杀分数 (详见敌机类型)
### 道具收集
- **任意道具**: +5分

### 分数等级影响
- **等级计算**: Math.floor(分数 / 500)
- **影响**: 敌机类型出现概率

## 音效系统

### 音效文件 (sounds目录)
- `shoot.mp3` - 射击音效
- `explosion.mp3` - 爆炸音效
- `hit.mp3` - 击中音效
- `powerup.mp3` - 道具收集音效
- `player_hurt.mp3` - 玩家受伤音效

## 控制系统

### 键盘控制
- **WASD/方向键**: 移动
- **空格键**: 暂停/恢复
- **鼠标**: 移动 + 射击
- **触摸**: 移动 + 自动射击

## 技术架构

### 主要类
- `ShootingGame` - 游戏主类
- `Player` - 玩家类
- `Enemy` - 敌机类
- `Bullet` - 子弹类
- `PowerUp` - 道具类
- `Particle` - 粒子效果类
- `Obstacle` - 障碍物类
- `Wingman` - 僚机类
- `Missile` - 导弹类
- `AudioManager` - 音频管理类

### 游戏状态
- `menu` - 菜单状态
- `playing` - 游戏进行中
- `paused` - 暂停状态
- `gameOver` - 游戏结束

## 维护指南

### 调整难度
1. **敌机生成频率**: 修改 `enemySpawnTimer` 相关逻辑
2. **敌机血量**: 修改各敌机类型的 `health` 属性
3. **伤害值**: 修改碰撞检测中的伤害计算

### 添加新敌机类型
1. 在 `spawnEnemy()` 中添加新的概率判断
2. 在 `setTypeProperties()` 中添加新类型属性
3. 在 `draw()` 方法中添加新的绘制函数
4. 在分数和伤害系统中添加对应数值

### 调整道具系统
1. **道具概率**: 修改 `spawnPowerUp()` 中的概率
2. **道具效果**: 修改碰撞检测中的道具处理逻辑
3. **解锁条件**: 修改相关计数器判断

### 性能优化
1. **对象池**: 可为子弹、粒子等频繁创建的对象实现对象池
2. **碰撞检测**: 可实现空间分割算法优化碰撞检测
3. **渲染优化**: 可实现视锥剔除，只渲染屏幕内对象

## 已知问题

1. **敌机生成间隔**: 高分时可能生成过于频繁
2. **内存管理**: 长时间游戏可能导致粒子对象累积
3. **移动端适配**: 触摸控制可能需要进一步优化

## 更新日志

### 最新版本特性
- ? 血量包系统 (收集计数、自动恢复、保护罩)
- ? 僚机系统 (双僚机支持)
- ? 导弹系统 (自动发射)
- ? 障碍物系统 (防挂机)
- ? 多种敌机类型
- ? 粒子特效系统
- ? 音效系统
- ? 响应式设计

---

**维护提示**: 修改数值时建议先在测试环境验证平衡性，避免影响游戏体验。